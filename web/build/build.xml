<?xml version="1.0" encoding="UTF-8"?>
<project name="Doorlock" default="build" basedir="." description="PiDuino Lock - Electronic Deadbolt System">
  <property file="./location.properties" />
  <property file="./build.properties" />
  <property file="./builds.properties" />
  <property name="message" value="Hello World!"/>
  <target name="prepare" description="builds package property files">
    <if>
      <available file='./builds.properties' type='file' />
        <then>
          <echo>Yep</echo>
        </then>
        <else>
            <fail>testing</fail>
        </else>
    </if>
    <fail unless="api.urls" message="Please add the 'apis.urls' property" />
  </target>
  <target name="build" description="Runs a clean dev build">
    <phingcall target="prepare" />
    <phingcall target="clean" />
    <phingcall target="update" />
    <!-- <phingcall target="prepare" /> -->
    <!-- <phingcall target="build" /> -->
    <!-- <phingcall target="runtests" /> -->
  </target>
  <target name="update" description="rebuilds this package">
    <echo msg="${env}"/>
    <echo msg="${webserver.root}"/>
    <!-- create env target that sets env variable-->
    <echo msg="${api.url}"/>
    <!-- <delete dir="${webserver.root}" /> -->
    <copy file="./build.properties" tofile="${webserver.root}/properties/general.ini" />
    <copy todir="${webserver.root}">
      <!-- <copy todir="${webserver.root}" overwrite="true"> -->
      <fileset dir="../src">
        <include name="**"></include>
      </fileset>
    </copy>
  </target>
  <target name="clean" description="rebuilds this package">
    <delete dir="${webserver.root}" />
  </target>
  <target name="properties" description="builds package property files">
    <echo msg=""/>
    <delete file="test" />
    <property name="branch" value="dev"/>
    <echo msg="${api.url}"/>
    <touch file="test"/>
    <append destFile="test" text="${api.url}${line.separator}" />
    <append destFile="test" text="${api.url}${line.separator}" />
    <append destFile="test" text="${api.url}${line.separator}" />
    <!-- <property name="branch" value="master"/> -->
  </target>

</project>
